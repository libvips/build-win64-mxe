This file is part of MXE. See LICENSE.md for licensing information.

Contains ad hoc patches for cross building.

From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Kleis Auke Wolthuizen <github@kleisauke.nl>
Date: Mon, 7 Oct 2019 11:30:00 +0200
Subject: [PATCH 1/2] Fix pkg-config file when using built-in loader(s)

See: https://gitlab.gnome.org/GNOME/gdk-pixbuf/merge_requests/50

diff --git a/meson.build b/meson.build
index 1111111..2222222 100644
--- a/meson.build
+++ b/meson.build
@@ -304,6 +304,9 @@ if not png_opt.disabled()
   if png_dep.found()
     enabled_loaders += 'png'
     loaders_deps += png_dep
+    if builtin_loaders.contains('png') or builtin_all_loaders
+      gdk_pixbuf_deps += png_dep
+    endif
   endif
 endif
 
@@ -344,9 +347,13 @@ else
 endif
 
 if native_windows_loaders
-  loaders_deps += cc.find_library('gdiplus')
-  loaders_deps += cc.find_library('ole32')
+  gdip_lib = cc.find_library('gdiplus')
+  ole32_lib = cc.find_library('ole32')
+  loaders_deps += [gdip_lib, ole32_lib]
   enabled_loaders += 'gdiplus'
+  if builtin_loaders.contains('gdiplus') or builtin_all_loaders
+    gdk_pixbuf_deps += [gdip_lib, ole32_lib]
+  endif
 endif
 
 # Don't check and build the jpeg loader if native_windows_loaders is true
@@ -377,6 +384,9 @@ if not jpeg_opt.disabled() and not native_windows_loaders
     if has_destroy_decompress and has_simple_progression
       gdk_pixbuf_conf.set('HAVE_PROGRESSIVE_JPEG', has_simple_progression)
     endif
+    if builtin_loaders.contains('jpeg') or builtin_all_loaders
+      gdk_pixbuf_deps += jpeg_dep
+    endif
   endif
 endif
 
@@ -390,6 +400,9 @@ if not tiff_opt.disabled() and not native_windows_loaders
   if tiff_dep.found()
     enabled_loaders += 'tiff'
     loaders_deps += tiff_dep
+    if builtin_loaders.contains('tiff') or builtin_all_loaders
+      gdk_pixbuf_deps += tiff_dep
+    endif
   endif
 endif
 
From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Matthias Clasen <mclasen@redhat.com>
Date: Sat, 30 Aug 2025 20:15:00 +0200
Subject: [PATCH 2/2] build: Always define thumbnailer_opt

This is necessary to keep cross-building working.

Upstream-Status: Backport [https://gitlab.gnome.org/GNOME/gdk-pixbuf/-/commit/d8ff7ec050b939ae21544194c124e7ba0eca5e2d]

diff --git a/meson.build b/meson.build
index 1111111..2222222 100644
--- a/meson.build
+++ b/meson.build
@@ -448,6 +448,8 @@ if not meson.is_cross_build()
   if not thumbnailer_opt.disabled()
     subdir('thumbnailer')
   endif
+else
+  thumbnailer_opt = disabler()
 endif
 
 # Documentation
