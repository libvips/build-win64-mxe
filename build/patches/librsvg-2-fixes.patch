This file is part of MXE. See LICENSE.md for licensing information.

Contains ad hoc patches for cross building.

From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Kleis Auke Wolthuizen <github@kleisauke.nl>
Date: Thu, 28 Mar 2024 18:29:25 +0100
Subject: [PATCH 1/4] Ignore any errors from native-static-libs query

It will not properly work with `-Zbuild-std`.

diff --git a/meson.build b/meson.build
index 1111111..2222222 100644
--- a/meson.build
+++ b/meson.build
@@ -353,13 +353,9 @@ if host_system in ['windows', 'linux']
   native_libs = run_command(
     rustc_query_native_static_libs_args,
     capture: true,
-    check: true
+    check: false
   )
 
-  if native_libs.stderr() != ''
-    error(native_libs.stderr())
-  endif
-
   foreach i: native_libs.stdout().split()
     if 'msvcrt' in i
       if i.endswith('.lib') # pre Rust 1.83

From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Kleis Auke Wolthuizen <github@kleisauke.nl>
Date: Fri, 7 Jul 2023 18:41:29 +0200
Subject: [PATCH 2/4] Disable PDF/PostScript features in cairo-rs

We build Cairo with `-Dzlib=disabled`, which implicitly disables
these surface backends.

diff --git a/librsvg-c/Cargo.toml b/librsvg-c/Cargo.toml
index 1111111..2222222 100644
--- a/librsvg-c/Cargo.toml
+++ b/librsvg-c/Cargo.toml
@@ -10,7 +10,7 @@ edition.workspace = true
 rust-version.workspace = true
 
 [dependencies]
-cairo-rs = { workspace = true, features = ["v1_16", "png", "pdf", "ps", "svg"] }
+cairo-rs = { workspace = true, features = ["v1_16", "png", "svg"] }
 cast.workspace = true
 float-cmp.workspace = true
 gdk-pixbuf = { workspace = true, optional = true }
diff --git a/rsvg/Cargo.toml b/rsvg/Cargo.toml
index 1111111..2222222 100644
--- a/rsvg/Cargo.toml
+++ b/rsvg/Cargo.toml
@@ -48,7 +48,7 @@ name = "rsvg"
 [dependencies]
 # Keep these in sync with respect to the cairo-rs version:
 #   src/lib.rs - toplevel example in the docs
-cairo-rs = { workspace = true, features = ["v1_16", "png", "pdf", "ps", "svg"] }
+cairo-rs = { workspace = true, features = ["v1_16", "png", "svg"] }
 cast.workspace = true
 cssparser.workspace = true
 cssparser-color.workspace = true

From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Kleis Auke Wolthuizen <github@kleisauke.nl>
Date: Sun, 21 Apr 2024 12:01:02 +0200
Subject: [PATCH 3/4] Disallow GIF and WebP embedded in SVG images

Upstream-Status: Inappropriate [disable feature]
This is specific to libvips' prebuilt binaries.

diff --git a/Cargo.lock b/Cargo.lock
index 1111111..2222222 100644
--- a/Cargo.lock
+++ b/Cargo.lock
@@ -425,12 +425,6 @@ version = "0.7.6"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "a1d728cc89cf3aee9ff92b05e62b19ee65a02b5702cff7d5a377e32c6ae29d8d"
 
-[[package]]
-name = "color_quant"
-version = "1.1.0"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "3d7b894f5411737b7867f4827955924d7c254fc9f4d91a6aad6b097804b1018b"
-
 [[package]]
 name = "colorchoice"
 version = "1.0.4"
@@ -908,16 +902,6 @@ dependencies = [
  "wasip2",
 ]
 
-[[package]]
-name = "gif"
-version = "0.13.3"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "4ae047235e33e2829703574b54fdec96bfbad892062d97fed2f76022287de61b"
-dependencies = [
- "color_quant",
- "weezl",
-]
-
 [[package]]
 name = "gio"
 version = "0.22.0-alpha.2"
@@ -1315,10 +1299,7 @@ checksum = "529feb3e6769d234375c4cf1ee2ce713682b8e76538cb13f9fc23e1400a591e7"
 dependencies = [
  "bytemuck",
  "byteorder-lite",
- "color_quant",
  "dav1d",
- "gif",
- "image-webp",
  "moxcms",
  "mp4parse",
  "num-traits",
@@ -1327,16 +1308,6 @@ dependencies = [
  "zune-jpeg",
 ]
 
-[[package]]
-name = "image-webp"
-version = "0.2.4"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "525e9ff3e1a4be2fbea1fdf0e98686a6d98b4d8f937e1bf7402245af1909e8c3"
-dependencies = [
- "byteorder-lite",
- "quick-error 2.0.1",
-]
-
 [[package]]
 name = "indexmap"
 version = "2.12.0"
diff --git a/rsvg/Cargo.toml b/rsvg/Cargo.toml
index 1111111..2222222 100644
--- a/rsvg/Cargo.toml
+++ b/rsvg/Cargo.toml
@@ -57,7 +57,7 @@ encoding_rs.workspace = true
 float-cmp.workspace = true
 gio.workspace = true
 glib.workspace = true
-image = { workspace = true, features = ["jpeg", "png", "gif", "webp"] }
+image = { workspace = true, features = ["jpeg", "png"] }
 itertools.workspace = true
 language-tags.workspace = true
 libc.workspace = true

From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Kleis Auke Wolthuizen <github@kleisauke.nl>
Date: Wed, 5 Nov 2025 10:39:31 +0100
Subject: [PATCH 4/4] Downgrade to windows-sys 0.60.2

Generated using:
cargo update -p windows-sys@0.61.2 --precise 0.60.2

Context: https://github.com/msys2/MINGW-packages/pull/26246#issuecomment-3486403668.

diff --git a/Cargo.lock b/Cargo.lock
index 1111111..2222222 100644
--- a/Cargo.lock
+++ b/Cargo.lock
@@ -706,7 +706,7 @@ source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "39cab71617ae0d63f51a36d69f866391735b51691dbda63cf6f96d042b63efeb"
 dependencies = [
  "libc",
- "windows-sys 0.61.2",
+ "windows-sys 0.59.0",
 ]
 
 [[package]]
@@ -929,7 +929,7 @@ dependencies = [
  "gobject-sys",
  "libc",
  "system-deps",
- "windows-sys 0.61.2",
+ "windows-sys 0.59.0",
 ]
 
 [[package]]
@@ -980,7 +980,7 @@ dependencies = [
  "gobject-sys",
  "libc",
  "system-deps",
- "windows-sys 0.61.2",
+ "windows-sys 0.59.0",
 ]
 
 [[package]]
@@ -2426,7 +2426,7 @@ dependencies = [
  "errno",
  "libc",
  "linux-raw-sys",
- "windows-sys 0.61.2",
+ "windows-sys 0.59.0",
 ]
 
 [[package]]
@@ -2735,7 +2735,7 @@ dependencies = [
  "getrandom",
  "once_cell",
  "rustix",
- "windows-sys 0.61.2",
+ "windows-sys 0.59.0",
 ]
 
 [[package]]
@@ -3100,7 +3100,7 @@ version = "0.1.11"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "c2a7b1c03c876122aa43f3020e6c3c3ee5c05081c9a00739faf7503aeba10d22"
 dependencies = [
- "windows-sys 0.61.2",
+ "windows-sys 0.59.0",
 ]
 
 [[package]]
@@ -3186,15 +3186,6 @@ dependencies = [
  "windows-targets 0.53.5",
 ]
 
-[[package]]
-name = "windows-sys"
-version = "0.61.2"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "ae137229bcbd6cdf0f7b80a31df61766145077ddf49416a728b02cb3921ff3fc"
-dependencies = [
- "windows-link",
-]
-
 [[package]]
 name = "windows-targets"
 version = "0.52.6"
