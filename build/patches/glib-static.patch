This file is part of MXE. See LICENSE.md for licensing information.

Contains ad hoc patches for cross building.

From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Kleis Auke Wolthuizen <github@kleisauke.nl>
Date: Mon, 13 May 2019 17:00:00 +0200
Subject: [PATCH 1/1] Build gio, gmodule and gthread static


diff --git a/gio/giomodule.c b/gio/giomodule.c
index 1111111..2222222 100644
--- a/gio/giomodule.c
+++ b/gio/giomodule.c
@@ -1110,27 +1110,8 @@ extern GType _g_win32_network_monitor_get_type (void);
 
 static HMODULE gio_dll = NULL;
 
-#ifndef GLIB_STATIC_COMPILATION
-
-BOOL WINAPI DllMain (HINSTANCE hinstDLL,
-                     DWORD     fdwReason,
-                     LPVOID    lpvReserved);
-
-BOOL WINAPI
-DllMain (HINSTANCE hinstDLL,
-	 DWORD     fdwReason,
-	 LPVOID    lpvReserved)
-{
-  if (fdwReason == DLL_PROCESS_ATTACH)
-    {
-      gio_dll = hinstDLL;
-      gio_win32_appinfo_init (FALSE);
-    }
-
-  return TRUE;
-}
-
-#elif defined(G_HAS_CONSTRUCTORS) /* && G_PLATFORM_WIN32 && GLIB_STATIC_COMPILATION */
+#ifdef GLIB_STATIC_COMPILATION
+#ifdef G_HAS_CONSTRUCTORS /* && G_PLATFORM_WIN32 && GLIB_STATIC_COMPILATION */
 extern void glib_win32_init (void);
 extern void gobject_win32_init (void);
 
@@ -1162,6 +1143,7 @@ giomodule_init_ctor (void)
 
 #else /* G_PLATFORM_WIN32 && GLIB_STATIC_COMPILATION && !G_HAS_CONSTRUCTORS */
 #error Your platform/compiler is missing constructor support
+#endif /* G_HAS_CONSTRUCTORS */
 #endif /* GLIB_STATIC_COMPILATION */
 
 void *
diff --git a/gio/meson.build b/gio/meson.build
index 1111111..2222222 100644
--- a/gio/meson.build
+++ b/gio/meson.build
@@ -792,12 +792,9 @@ else
   gio_dtrace_hdr = []
 endif
 
-libgio = library('gio-2.0',
+libgio = static_library('gio-2.0',
   gioenumtypes_h, gioenumtypes_c, gnetworking_h, gio_sources,
   gio_dtrace_hdr, gio_dtrace_obj,
-  version : library_version,
-  soversion : soversion,
-  darwin_versions : darwin_versions,
   install : true,
   include_directories : [configinc, gioinc],
   #  '$(gio_win32_res_ldflag)',
diff --git a/gmodule/meson.build b/gmodule/meson.build
index 1111111..2222222 100644
--- a/gmodule/meson.build
+++ b/gmodule/meson.build
@@ -77,11 +77,8 @@ if host_system == 'windows'
   gmodule_sources += [gmodule_win_res]
 endif
 
-libgmodule = library('gmodule-2.0',
+libgmodule = static_library('gmodule-2.0',
   sources : gmodule_sources,
-  version : library_version,
-  soversion : soversion,
-  darwin_versions : darwin_versions,
   install : true,
   include_directories : [configinc, gmoduleinc],
   dependencies : [libdl_dep, libglib_dep],
diff --git a/gthread/meson.build b/gthread/meson.build
index 1111111..2222222 100644
--- a/gthread/meson.build
+++ b/gthread/meson.build
@@ -12,11 +12,8 @@ if host_system == 'windows'
   gthread_sources += [gthread_win_res]
 endif
 
-libgthread = library('gthread-2.0',
+libgthread = static_library('gthread-2.0',
   sources : gthread_sources,
-  version : library_version,
-  soversion : soversion,
-  darwin_versions : darwin_versions,
   install : true,
   dependencies : [libglib_dep],
   c_args : ['-DG_LOG_DOMAIN="GThread"' ] + glib_hidden_visibility_args,
