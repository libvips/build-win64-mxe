From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Kleis Auke Wolthuizen <github@kleisauke.nl>
Date: Sat, 13 Feb 2021 16:52:06 +0100
Subject: [PATCH 1/1] Fix plugin suffix for libvips >= 8.11


diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index 1111111..2222222 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -19,10 +19,26 @@ target_link_libraries(${PROJECT_NAME}
 
 set_target_properties(${PROJECT_NAME}
         PROPERTIES
-            PREFIX ""
-            SUFFIX ".plg" # libvips plugins needs .plg as suffix
+            PREFIX "" # Avoid lib prefix
         )
 
+if (VIPS_VERSION VERSION_GREATER_EQUAL 8.11)
+    # libvips plugins on macOS needs .so as suffix, see:
+    # https://gitlab.gnome.org/GNOME/glib/issues/1413
+    if (APPLE)
+        set_target_properties(${PROJECT_NAME}
+                PROPERTIES
+                    SUFFIX ".so"
+                )
+    endif()
+else()
+    # libvips plugins prior to v8.11 needs .plg as suffix
+    set_target_properties(${PROJECT_NAME}
+            PROPERTIES
+                SUFFIX ".plg"
+            )
+endif()
+
 string(REPLACE "." ";" VERSION_LIST ${VIPS_VERSION})
 list(GET VERSION_LIST 0 VIPS_MAJOR)
 list(GET VERSION_LIST 1 VIPS_MINOR)
